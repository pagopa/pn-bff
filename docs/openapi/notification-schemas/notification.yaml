info:
  version: v1.0
components:
  schemas:

    BffNotificationsResponse:
      $ref: 'https://raw.githubusercontent.com/pagopa/pn-delivery/1bb29785f067926d24f19f229a9b9dcdea0ea75b/docs/openapi/schemas-pn-notification.yaml#/components/schemas/NotificationSearchResponse'

    BffFullNotificationV1:
      description: >-
        Dettaglio notifica con elementi per il Frontend
      allOf:
        - $ref: 'https://raw.githubusercontent.com/pagopa/pn-delivery/1bb29785f067926d24f19f229a9b9dcdea0ea75b/docs/openapi/schemas-pn-notification.yaml#/components/schemas/SentNotificationV23'
        - type: object
          required:
            - notificationStatusHistory
            - notificationStatus
            - timeline
          properties:
            notificationStatusHistory:
              type: array
              items:
                $ref: '#/components/schemas/BffNotificationStatusHistory'
            notificationStatus:
              $ref: '#/components/schemas/BffNotificationStatus'
            timeline:
              type: array
              items:
                $ref: '#/components/schemas/BffNotificationDetailTimeline'
            radd:
              $ref: '#/components/schemas/BffNotificationDetailTimeline'
            otherDocuments:
              type: array
              items:
                $ref: '#/components/schemas/BffNotificationDetailDocument'

    BffNotificationStatusHistory:
      type: object
      additionalProperties: false
      required:
        - status
        - activeFrom
        - relatedTimelineElements
      properties:
        status:
          $ref: '#/components/schemas/BffNotificationStatus'
        activeFrom:
          type: string
          format: date-time
        relatedTimelineElements:
          type: array
          items:
            type: string
        steps:
          type: array
          items:
            $ref: '#/components/schemas/BffNotificationDetailTimeline'
        recipient:
          type: string
        deliveryMode:
          $ref: '#/components/schemas/BffNotificationDeliveryMode'

    BffNotificationStatus:
      type: string
      enum:
        - IN_VALIDATION
        - ACCEPTED
        - DELIVERING
        - DELIVERED
        - VIEWED
        - EFFECTIVE_DATE
        - PAID
        - UNREACHABLE
        - CANCELLED
        - REFUSED
        - CANCELLATION_IN_PROGRESS

    BffNotificationDeliveryMode:
      type: string
      enum:
        - analog
        - digital

    BffNotificationDetailDocument:
      description: >-
        Documento della notifica.
      allOf:
        - $ref: 'https://raw.githubusercontent.com/pagopa/pn-delivery/1bb29785f067926d24f19f229a9b9dcdea0ea75b/docs/openapi/schemas-pn-notification.yaml#/components/schemas/NotificationMetadataAttachment'
        - type: object
          properties:
            title:
              type: string
              minLength: 1
              maxLength: 512
              pattern: ^.*$
            requiresAck:
              type: string
            docIdx:
              type: string
              maxLength: 3
              pattern: ^\d+$
            documentId:
              type: string
            documentType:
              type: string
            recIndex:
              type: integer

    BffLegalFactId:
      type: object
      required:
        - key
        - category
      properties:
        key:
          type: string
          pattern: ^(safestorage:\/\/)?[A-Za-z0-9._-]+$
          maxLength: 512
        category:
          $ref: "#/components/schemas/BffLegalFactType"

    BffLegalFactType:
      type: string
      enum:
        - AAR
        - SENDER_ACK
        - DIGITAL_DELIVERY
        - ANALOG_DELIVERY
        - RECIPIENT_ACCESS
        - PEC_RECEIPT
        - ANALOG_FAILURE_DELIVERY

    BffNotificationDetailTimeline:
      type: object
      required:
        - elementId
        - timestamp
        - category
        - details
      additionalProperties: false
      properties:
        elementId:
          type: string
        timestamp:
          type: string
          format: date-time
        legalFactsIds:
          type: array
          items:
            $ref: "#/components/schemas/BffLegalFactId"
        category:
          $ref: "#/components/schemas/BffTimelineCategory"
        details:
          $ref: "#/components/schemas/BffNotificationDetailTimelineDetails"
        hidden:
          type: boolean
        index:
          type: integer

    BffTimelineCategory:
      $ref: 'https://raw.githubusercontent.com/pagopa/pn-delivery-push/97e92c13dd34b1690c3193836dd1d6e51aafb30f/docs/openapi/schemas-pn-timeline.yaml#/components/schemas/TimelineElementCategoryV23'

    BffNotificationDetailTimelineDetails:
      $ref: 'https://raw.githubusercontent.com/pagopa/pn-delivery-push/97e92c13dd34b1690c3193836dd1d6e51aafb30f/docs/openapi/schemas-pn-timeline.yaml#/components/schemas/TimelineElementDetailsV23'
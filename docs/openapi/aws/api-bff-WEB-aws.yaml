openapi: 3.0.1
info:
  title: >-
    ${stageVariables.ProjectName}-${stageVariables.MicroServiceUniqueName}-${stageVariables.IntendedUsage}
  version: rpP5SYQIwgrr1aaZuoF6Oa3FtifYc4TTm6eHKnzxDD8=
servers:
  - url: https://${stageVariables.DnsName}/{basePath}
    variables:
      basePath:
        default: /${stageVariables.ServiceApiPath}
    x-amazon-apigateway-endpoint-configuration:
      disableExecuteApiEndpoint: true
paths:
  /v1/notifications/sent/{iun}:
    get:
      summary: 'Mittente: lettura dettagli notifica versione 1'
      description: >-
        Questa operazione permette di leggere tutti i dettagli di una notifica
        accettata.
      tags:
        - NotificationSent
      parameters:
        - $ref: '#/components/parameters/pathIun'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BffFullNotificationV1'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
      security:
        - pn-auth-fleet_jwtAuthorizer_openapi: []
      x-amazon-apigateway-integration:
        uri: >-
          http://${stageVariables.ApplicationLoadBalancerDomain}:8080/${stageVariables.ServiceApiPath}/v1/notifications/sent/{iun}
        connectionId: ${stageVariables.NetworkLoadBalancerLink}
        httpMethod: ANY
        requestParameters:
          integration.request.header.x-pagopa-pn-cx-id: context.authorizer.cx_id
          integration.request.header.x-pagopa-pn-cx-role: context.authorizer.cx_role
          integration.request.header.x-pagopa-pn-uid: context.authorizer.uid
          integration.request.header.x-pagopa-pn-jti: context.authorizer.cx_jti
          integration.request.header.x-pagopa-pn-src-ch: '''WEB'''
          integration.request.header.x-pagopa-pn-cx-type: context.authorizer.cx_type
          integration.request.header.x-pagopa-pn-cx-groups: context.authorizer.cx_groups
          integration.request.header.x-pagopa-pn-src-ch-details: context.authorizer.sourceChannelDetails
          integration.request.path.iun: method.request.path.iun
        passthroughBehavior: when_no_match
        connectionType: VPC_LINK
        timeoutInMillis: 29000
        type: http_proxy
    options:
      operationId: Options for /v1/notifications/sent/{iun} API CORS
      x-amazon-apigateway-integration:
        uri: >-
          http://${stageVariables.ApplicationLoadBalancerDomain}:8080/${stageVariables.ServiceApiPath}/v1/notifications/sent/{iun}
        connectionId: ${stageVariables.NetworkLoadBalancerLink}
        httpMethod: ANY
        requestParameters:
          integration.request.path.iun: method.request.path.iun
        passthroughBehavior: when_no_match
        connectionType: VPC_LINK
        timeoutInMillis: 29000
        type: http_proxy
  /v1/notifications/received/{iun}:
    get:
      summary: Accesso notifiche ricevute
      description: >-
        Utilizzato da Persone Fisiche e Persone Giuridiche per accedere ai
        dettagli delle  notifiche ricevute.
      tags:
        - NotificationReceived
      operationId: getReceivedNotificationV1
      parameters:
        - $ref: '#/components/parameters/pathIun'
        - $ref: '#/components/parameters/notificationSearchMandateId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BffFullNotificationV1'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
      security:
        - pn-auth-fleet_jwtAuthorizer_openapi: []
      x-amazon-apigateway-integration:
        uri: >-
          http://${stageVariables.ApplicationLoadBalancerDomain}:8080/${stageVariables.ServiceApiPath}/v1/notifications/received/{iun}
        connectionId: ${stageVariables.NetworkLoadBalancerLink}
        httpMethod: ANY
        requestParameters:
          integration.request.header.x-pagopa-pn-cx-id: context.authorizer.cx_id
          integration.request.header.x-pagopa-pn-cx-role: context.authorizer.cx_role
          integration.request.header.x-pagopa-pn-uid: context.authorizer.uid
          integration.request.header.x-pagopa-pn-jti: context.authorizer.cx_jti
          integration.request.header.x-pagopa-pn-src-ch: '''WEB'''
          integration.request.header.x-pagopa-pn-cx-type: context.authorizer.cx_type
          integration.request.header.x-pagopa-pn-cx-groups: context.authorizer.cx_groups
          integration.request.header.x-pagopa-pn-src-ch-details: context.authorizer.sourceChannelDetails
          integration.request.path.iun: method.request.path.iun
        passthroughBehavior: when_no_match
        connectionType: VPC_LINK
        timeoutInMillis: 29000
        type: http_proxy
    options:
      operationId: Options for /v1/notifications/received/{iun} API CORS
      x-amazon-apigateway-integration:
        uri: >-
          http://${stageVariables.ApplicationLoadBalancerDomain}:8080/${stageVariables.ServiceApiPath}/v1/notifications/received/{iun}
        connectionId: ${stageVariables.NetworkLoadBalancerLink}
        httpMethod: ANY
        requestParameters:
          integration.request.path.iun: method.request.path.iun
        passthroughBehavior: when_no_match
        connectionType: VPC_LINK
        timeoutInMillis: 29000
        type: http_proxy
components:
  parameters:
    pathIun:
      description: Identificativo Univoco Notifica
      name: iun
      in: path
      required: true
      schema:
        type: string
        minLength: 25
        maxLength: 25
        pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
    notificationSearchMandateId:
      name: mandateId
      in: query
      required: false
      description: identificativo della delega
      schema:
        type: string
  schemas:
    StatusSchema:
      title: Stato dell'applicazione
      type: object
      properties:
        status:
          type: string
          description: Stato dell'applicazione.
      required:
        - status
      example:
        status: OK
    BffFullNotificationV1:
      description: Dettaglio notifica con elementi per il Frontend
      required:
        - paProtocolNumber
        - subject
        - recipients
        - documents
        - notificationFeePolicy
        - physicalCommunicationType
        - senderPaId
        - iun
        - sentAt
        - notificationStatus
        - notificationStatusHistory
        - timeline
      type: object
      properties:
        idempotenceToken:
          type: string
          pattern: ^[ -~]*$
          maxLength: 256
        paProtocolNumber:
          type: string
          pattern: ^.*$
          maxLength: 256
        subject:
          type: string
          maxLength: 134
          pattern: ^.*$
        abstract:
          type: string
          pattern: ^.*$
          maxLength: 1024
        recipients:
          type: array
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          items:
            $ref: '#/components/schemas/NotificationDetailRecipient'
        documents:
          type: array
          items:
            $ref: '#/components/schemas/NotificationDetailDocument'
          minItems: 1
        notificationFeePolicy:
          $ref: '#/components/schemas/NotificationFeePolicy'
        cancelledIun:
          $ref: '#/components/schemas/IUN'
        physicalCommunicationType:
          $ref: '#/components/schemas/PhysicalCommunicationType'
        senderDenomination:
          $ref: '#/components/schemas/Denomination'
        paymentExpirationDate:
          type: string
          minLength: 10
          maxLength: 10
          pattern: ^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|[12][0-9]|0[1-9])$
        senderTaxId:
          $ref: '#/components/schemas/paTaxId'
        group:
          type: string
          pattern: ^[ -~]*$
          maxLength: 1024
        senderPaId:
          type: string
          pattern: ^.*$
          maxLength: 256
        iun:
          $ref: '#/components/schemas/IUN'
        sentAt:
          type: string
          format: date-time
        cancelledByIun:
          $ref: '#/components/schemas/IUN'
        documentsAvailable:
          type: boolean
        notificationStatus:
          $ref: '#/components/schemas/NotificationStatus'
        notificationStatusHistory:
          type: array
          items:
            $ref: '#/components/schemas/NotificationStatusHistory'
        timeline:
          type: array
          items:
            $ref: '#/components/schemas/NotificationDetailTimeline'
        amount:
          type: number
        otherDocuments:
          type: array
          items:
            $ref: '#/components/schemas/NotificationDetailDocument'
    Problem:
      properties:
        type:
          description: URI reference of type definition
          type: string
        status:
          description: >-
            The HTTP status code generated by the origin server for this
            occurrence of the problem.
          type: number
          example: 503
          maximum: 600
          minimum: 100
          exclusiveMaximum: true
        title:
          description: >-
            A short, summary of the problem type. Written in english and
            readable
          example: Service Unavailable
          maxLength: 64
          pattern: ^[ -~]{0,64}$
          type: string
        detail:
          description: A human readable explanation of the problem.
          example: Request took too long to complete.
          maxLength: 4096
          pattern: ^.{0,4096}$
          type: string
        traceId:
          description: Internal support identifier associated to error
          example: 123e4567-e89b-12d3-a456-426614174000
          type: string
        timestamp:
          description: date and time referred to UTC
          example: '2022-07-27T12:22:33.444Z'
          type: string
          format: date-time
        errors:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/ProblemError'
      required:
        - status
        - errors
    RecipientType:
      type: string
      enum:
        - PF
        - PG
    DigitalDomicileType:
      type: string
      enum:
        - PEC
        - EMAIL
        - APPIO
        - SMS
    DigitalAddress:
      type: object
      required:
        - type
        - address
      properties:
        type:
          $ref: '#/components/schemas/DigitalDomicileType'
        address:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: >-
            ^([a-zA-Z0-9]+(?:[.\-_][a-zA-Z0-9]+){0,10}@[a-zA-Z0-9]+(?:[.-][a-zA-Z0-9]+){0,10}(?:\.[a-zA-Z0-9]{2,10}))$
          maxLength: 320
    PhysicalAddress:
      type: object
      required:
        - address
        - zip
        - municipality
      properties:
        at:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          maxLength: 256
        address:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          minLength: 2
          maxLength: 1024
        addressDetails:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          maxLength: 1024
        zip:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          minLength: 0
          maxLength: 15
          pattern: ^(\w|\ |\-)*$
        municipality:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          minLength: 2
          maxLength: 256
        municipalityDetails:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          maxLength: 256
        province:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          maxLength: 256
        foreignState:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          pattern: ^.*$
          maxLength: 256
    NotificationAttachmentDigests:
      description: Codici per la verifica del corretto caricamento di un allegato
      type: object
      required:
        - sha256
      properties:
        sha256:
          type: string
          minLength: 44
          maxLength: 44
          pattern: ^[A-Za-z0-9+\/]{43}=|[A-Za-z0-9+\/]{44}$
    NotificationAttachmentBodyRef:
      description: Riferimento all'allegato precaricato
      required:
        - key
        - versionToken
      type: object
      properties:
        key:
          type: string
          maxLength: 512
        versionToken:
          type: string
          pattern: ^.*$
          maxLength: 256
    NotificationAttachment:
      description: Un allegato della notifica.
      type: object
      required:
        - digests
        - contentType
        - ref
      properties:
        digests:
          $ref: '#/components/schemas/NotificationAttachmentDigests'
        contentType:
          type: string
          minLength: 15
          maxLength: 15
          pattern: ^application\/pdf$
        ref:
          $ref: '#/components/schemas/NotificationAttachmentBodyRef'
    NotificationDetailDocument:
      description: Documento della notifica.
      allOf:
        - $ref: '#/components/schemas/NotificationAttachment'
        - type: object
          properties:
            title:
              type: string
            requiresAck:
              type: string
            docIdx:
              type: string
            documentId:
              type: string
            documentType:
              type: string
            recIndex:
              type: number
    PagoPAPaymentDetails:
      type: object
      required:
        - noticeCode
        - creditorTaxId
        - applyCost
      properties:
        creditorTaxId:
          type: string
          maxLength: 11
          minLength: 11
          pattern: ^\d+$
        noticeCode:
          type: string
          maxLength: 18
          minLength: 18
          pattern: ^\d+$
        attachment:
          $ref: '#/components/schemas/NotificationDetailDocument'
        applyCost:
          type: boolean
          nullable: false
        attachmentIdx:
          type: number
    F24PaymentDetails:
      type: object
      required:
        - title
        - applyCost
        - metadataAttachment
      properties:
        title:
          type: string
        applyCost:
          type: boolean
        recIndex:
          type: number
        attachmentIdx:
          type: number
        metadataAttachment:
          $ref: '#/components/schemas/NotificationAttachment'
    NotificationDetailPayment:
      type: object
      properties:
        pagoPa:
          $ref: '#/components/schemas/PagoPAPaymentDetails'
        f24:
          $ref: '#/components/schemas/F24PaymentDetails'
    NotificationDetailRecipient:
      type: object
      required:
        - recipientType
        - taxId
        - denomination
      properties:
        recipientType:
          $ref: '#/components/schemas/RecipientType'
        taxId:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          minLength: 11
          maxLength: 16
          pattern: >-
            ^([A-Z]{6}[0-9LMNPQRSTUV]{2}[A-Z]{1}[0-9LMNPQRSTUV]{2}[A-Z]{1}[0-9LMNPQRSTUV]{3}[A-Z]{1})|([0-9]{11})$
        denomination:
          type: string
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          minLength: 1
          maxLength: 80
          pattern: ^.*$
        digitalDomicile:
          $ref: '#/components/schemas/DigitalAddress'
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        payments:
          type: array
          items:
            $ref: '#/components/schemas/NotificationDetailPayment'
    NotificationFeePolicy:
      type: string
      enum:
        - FLAT_RATE
        - DELIVERY_MODE
    IUN:
      description: Identificativo Univoco Notifica
      type: string
      minLength: 25
      maxLength: 25
      pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
    PhysicalCommunicationType:
      type: string
      enum:
        - AR_REGISTERED_LETTER
        - REGISTERED_LETTER_890
    Denomination:
      description: Denominazione ente o persona fisica / ragione sociale
      type: string
      x-field-extra-annotation: '@lombok.ToString.Exclude'
      minLength: 1
      maxLength: 80
      pattern: ^.*$
    paTaxId:
      description: Payment PA fiscal code
      type: string
      maxLength: 11
      minLength: 11
      pattern: ^\d+$
    NotificationStatus:
      type: string
      enum:
        - IN_VALIDATION
        - ACCEPTED
        - DELIVERING
        - DELIVERED
        - VIEWED
        - EFFECTIVE_DATE
        - PAID
        - UNREACHABLE
        - CANCELLED
        - REFUSED
        - CANCELLATION_IN_PROGRESS
    LegalFactType:
      type: string
      enum:
        - AAR
        - SENDER_ACK
        - DIGITAL_DELIVERY
        - ANALOG_DELIVERY
        - ANALOG_FAILURE_DELIVERY
        - RECIPIENT_ACCESS
        - PEC_RECEIPT
    LegalFactId:
      type: object
      properties:
        key:
          type: string
          pattern: ^(safestorage:\/\/)?[A-Za-z0-9._-]+$
          maxLength: 512
        category:
          $ref: '#/components/schemas/LegalFactType'
    TimelineCategory:
      type: string
      enum:
        - REQUEST_ACCEPTED
        - SEND_COURTESY_MESSAGE
        - GET_ADDRESS
        - PUBLIC_REGISTRY_CALL
        - PUBLIC_REGISTRY_RESPONSE
        - SCHEDULE_ANALOG_WORKFLOW
        - SCHEDULE_DIGITAL_WORKFLOW
        - SEND_DIGITAL_DOMICILE
        - SEND_DIGITAL_PROGRESS
        - SEND_DIGITAL_FEEDBACK
        - REFINEMENT
        - SCHEDULE_REFINEMENT
        - DIGITAL_SUCCESS_WORKFLOW
        - DIGITAL_FAILURE_WORKFLOW
        - ANALOG_SUCCESS_WORKFLOW
        - ANALOG_FAILURE_WORKFLOW
        - SEND_SIMPLE_REGISTERED_LETTER
        - SEND_SIMPLE_REGISTERED_LETTER_PROGRESS
        - NOTIFICATION_VIEWED
        - SEND_ANALOG_DOMICILE
        - PAYMENT
        - COMPLETELY_UNREACHABLE
        - REQUEST_REFUSED
        - NOT_HANDLED
        - PREPARE_SIMPLE_REGISTERED_LETTER
        - PREPARE_ANALOG_DOMICILE
        - PREPARE_ANALOG_DOMICILE_FAILURE
        - SEND_ANALOG_PROGRESS
        - SEND_ANALOG_FEEDBACK
        - AAR_GENERATION
        - NOTIFICATION_CANCELLATION_REQUEST
        - NOTIFICATION_CANCELLED
        - SENDER_ACK_CREATION_REQUEST
        - VALIDATE_NORMALIZE_ADDRESSES_REQUEST
        - NORMALIZED_ADDRESS
        - PREPARE_DIGITAL_DOMICILE
        - DIGITAL_DELIVERY_CREATION_REQUEST
        - NOTIFICATION_VIEWED_CREATION_REQUEST
        - COMPLETELY_UNREACHABLE_CREATION_REQUEST
        - AAR_CREATION_REQUEST
        - PROBABLE_SCHEDULING_ANALOG_DATE
        - NOTIFICATION_RADD_RETRIEVED
    BaseDetails:
      type: object
      properties:
        recIndex:
          type: number
        eventTimestamp:
          type: string
    AarDetails:
      type: object
      properties:
        recIndex:
          type: number
        errors:
          type: array
          items:
            type: string
        generatedAarUrl:
          type: string
        numberOfPages:
          type: number
    ViewedDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            delegateInfo:
              type: object
              properties:
                internalId:
                  type: string
                taxId:
                  type: string
                operatorUuid:
                  type: string
                mandateId:
                  type: string
                denomination:
                  type: string
                delegateType:
                  $ref: '#/components/schemas/RecipientType'
    AnalogWorkflowDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            physicalAddress:
              $ref: '#/components/schemas/PhysicalAddress'
    DigitalWorkflowDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            digitalAddress:
              $ref: '#/components/schemas/DigitalAddress'
    AddressSource:
      type: string
      enum:
        - PLATFORM
        - SPECIAL
        - GENERAL
    AddressInfoDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            digitalAddressSource:
              $ref: '#/components/schemas/AddressSource'
            isAvailable:
              type: boolean
            attemptDate:
              type: string
    NotificationDeliveryMode:
      type: string
      enum:
        - analog
        - digital
    ContactPhase:
      type: string
      enum:
        - CHOOSE_DELIVERY
        - SEND_ATTEMPT
    PublicRegistryCallDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            deliveryMode:
              $ref: '#/components/schemas/NotificationDeliveryMode'
            contactPhase:
              $ref: '#/components/schemas/ContactPhase'
            sentAttemptMade:
              type: number
            sendDate:
              type: string
    PublicRegistryResponseDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            digitalAddress:
              $ref: '#/components/schemas/DigitalAddress'
            physicalAddress:
              $ref: '#/components/schemas/PhysicalAddress'
    RequestRefusedDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            errors:
              type: array
              items:
                type: string
    ScheduleDigitalWorkflowDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - $ref: '#/components/schemas/DigitalAddress'
        - type: object
          properties:
            digitalAddress:
              $ref: '#/components/schemas/DigitalAddress'
            digitalAddressSource:
              $ref: '#/components/schemas/AddressSource'
            sentAttemptMade:
              type: number
            lastAttemptDate:
              type: string
    AppIoCourtesyMessageEventType:
      type: string
      enum:
        - SENT_COURTESY
        - SENT_OPTIN
        - NOT_SENT_OPTIN_ALREADY_SENT
    SendCourtesyMessageDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            digitalAddress:
              $ref: '#/components/schemas/DigitalAddress'
            sendDate:
              type: string
            ioSendMessageResult:
              $ref: '#/components/schemas/AppIoCourtesyMessageEventType'
    SimpleResponseStatus:
      type: string
      enum:
        - OK
        - KO
    SendDigitalDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            digitalAddress:
              $ref: '#/components/schemas/DigitalAddress'
            responseStatus:
              $ref: '#/components/schemas/SimpleResponseStatus'
            deliveryDetailCode:
              type: string
            digitalAddressSource:
              $ref: '#/components/schemas/AddressSource'
            retryNumber:
              type: number
            notificationDate:
              type: string
    ResponseStatus:
      type: string
      enum:
        - OK
        - PROGRESS
        - PROGRESS_WITH_RETRY
        - KO
    SendPaperDetails:
      allOf:
        - $ref: '#/components/schemas/AnalogWorkflowDetails'
        - type: object
          properties:
            serviceLevel:
              $ref: '#/components/schemas/PhysicalCommunicationType'
            productType:
              type: string
            registeredLetterCode:
              type: string
            responseStatus:
              $ref: '#/components/schemas/ResponseStatus'
            deliveryFailureCause:
              type: string
            deliveryDetailCode:
              type: string
            sendRequestId:
              type: string
            attachments:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  documentType:
                    type: string
                  url:
                    type: string
    PaidDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            paymentSourceChannel:
              type: string
            recipientType:
              $ref: '#/components/schemas/RecipientType'
            amount:
              type: number
            creditorTaxId:
              type: string
            noticeCode:
              type: string
            uncertainPaymentDate:
              type: boolean
    NotHandledDetails:
      allOf:
        - $ref: '#/components/schemas/BaseDetails'
        - type: object
          properties:
            reasonCode:
              type: string
            reason:
              type: string
    NotificationDetailTimelineDetails:
      type: object
      oneOf:
        - $ref: '#/components/schemas/BaseDetails'
        - $ref: '#/components/schemas/AarDetails'
        - $ref: '#/components/schemas/ViewedDetails'
        - $ref: '#/components/schemas/AnalogWorkflowDetails'
        - $ref: '#/components/schemas/DigitalWorkflowDetails'
        - $ref: '#/components/schemas/AddressInfoDetails'
        - $ref: '#/components/schemas/PublicRegistryCallDetails'
        - $ref: '#/components/schemas/PublicRegistryResponseDetails'
        - $ref: '#/components/schemas/RequestRefusedDetails'
        - $ref: '#/components/schemas/ScheduleDigitalWorkflowDetails'
        - $ref: '#/components/schemas/SendCourtesyMessageDetails'
        - $ref: '#/components/schemas/SendDigitalDetails'
        - $ref: '#/components/schemas/SendPaperDetails'
        - $ref: '#/components/schemas/PaidDetails'
        - $ref: '#/components/schemas/NotHandledDetails'
    NotificationDetailTimeline:
      type: object
      required:
        - elementId
        - timestamp
        - category
        - details
      additionalProperties: false
      properties:
        elementId:
          type: string
        timestamp:
          type: string
        legalFactsIds:
          type: array
          items:
            $ref: '#/components/schemas/LegalFactId'
        category:
          $ref: '#/components/schemas/TimelineCategory'
        details:
          $ref: '#/components/schemas/NotificationDetailTimelineDetails'
        hidden:
          type: boolean
        index:
          type: number
    NotificationStatusHistory:
      type: object
      additionalProperties: false
      required:
        - status
        - activeFrom
        - relatedTimelineElements
      properties:
        status:
          $ref: '#/components/schemas/NotificationStatus'
        activeFrom:
          type: string
          format: date-time
        relatedTimelineElements:
          type: array
          items:
            type: string
        steps:
          type: array
          items:
            $ref: '#/components/schemas/NotificationDetailTimeline'
        recipient:
          type: string
        deliveryMode:
          $ref: '#/components/schemas/NotificationDeliveryMode'
    ProblemError:
      properties:
        code:
          description: Internal code of the error, in human-readable format
          example: >-
            PN_PARAMETER_TOO_LONG | PN_PARAMETER_TOO_SHORT | PN_DUPLICATE_ENTRY
            | etc...
          type: string
        element:
          description: Parameter or request body field name for validation error
          example: body.order.item[2].quantity
          type: string
        detail:
          description: >-
            A human readable explanation specific to this occurrence of the
            problem.
          example: Parameter not valid
          maxLength: 1024
          type: string
      required:
        - code
  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
  securitySchemes:
    pn-auth-fleet_jwtAuthorizer_openapi:
      type: apiKey
      name: Authorization
      in: header
      x-amazon-apigateway-authtype: custom
      x-amazon-apigateway-authorizer:
        authorizerUri: >-
          arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:pn-jwtAuthorizerLambda/invocations
        authorizerResultTtlInSeconds: 300
        identityValidationExpression: ^Bearer\s([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)\.([a-zA-Z0-9_\-]+)$
        type: token
tags:
  - name: HealthCheck
    description: Invocazioni per sapere lo stato del microservizio
  - name: NotificationSent
    description: >-
      Invocazioni utilizzabili dai mittenti per verificare lo stato delle
      richieste  di notifica inviate e delle notifiche accettate.
  - name: NotificationReceived
    description: >-
      Invocazioni utilizzate dai destinatari per ottenere informazioni sulle
      notifiche a loro destinate.
x-amazon-apigateway-gateway-responses:
  DEFAULT_5XX:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
  DEFAULT_4XX:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
  BAD_REQUEST_PARAMETERS:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
    responseTemplates:
      application/json: >-
        {"status": 400, "title": "VALIDATION ERROR", "traceId":
        "$context.xrayTraceId", "errors": [ { "code": "PN_INVALID_PARAMETERS",
        "detail": "Validation errors: $context.error.validationErrorString" } ]}
  BAD_REQUEST_BODY:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
    responseTemplates:
      application/json: >-
        {"status": 400, "title": "VALIDATION ERROR", "traceId":
        "$context.xrayTraceId", "errors": [ { "code": "PN_INVALID_BODY",
        "detail": "Validation errors: $context.error.validationErrorString" } ]}
x-amazon-apigateway-request-validators:
  basic:
    validateRequestBody: true
    validateRequestParameters: true
  params-only:
    validateRequestBody: false
    validateRequestParameters: true
x-amazon-apigateway-request-validator: basic
